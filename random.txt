if (search.getFromDate() != null || search.getToDate() != null) {
    if (search.getFromDate() != null && search.getToDate() != null) {
        cal.setTime(search.getToDate());
        cal.add(Calendar.DATE, 1); // Adjust end of day
        Date endOfDay = cal.getTime();
        
        // Filter for all project statuses
        spec = spec.and((root, query, criteriaBuilder) -> 
            criteriaBuilder.between(root.get("auditDate"), search.getFromDate(), endOfDay)
        );

        // Add additional check for CLOSED projectStatus
        spec = spec.and((root, query, criteriaBuilder) -> 
            criteriaBuilder.or(
                criteriaBuilder.notEqual(root.get("projectStatus"), "CLOSE"), // Apply only if not CLOSE
                criteriaBuilder.between(root.get("closedStatusDateTime"), search.getFromDate(), endOfDay) // Additional filter for CLOSE
            )
        );

    } else if (search.getFromDate() != null) {
        // Filter for all project statuses
        spec = spec.and((root, query, criteriaBuilder) -> 
            criteriaBuilder.greaterThanOrEqualTo(root.get("auditDate"), search.getFromDate())
        );

        // Add additional check for CLOSED projectStatus
        spec = spec.and((root, query, criteriaBuilder) -> 
            criteriaBuilder.or(
                criteriaBuilder.notEqual(root.get("projectStatus"), "CLOSE"),
                criteriaBuilder.greaterThanOrEqualTo(root.get("closedStatusDateTime"), search.getFromDate())
            )
        );

    } else if (search.getToDate() != null) {
        cal.setTime(search.getToDate());
        cal.add(Calendar.DATE, 1); // Adjust end of day
        Date endOfDay = cal.getTime();
        
        // Filter for all project statuses
        spec = spec.and((root, query, criteriaBuilder) -> 
            criteriaBuilder.lessThanOrEqualTo(root.get("auditDate"), endOfDay)
        );

        // Add additional check for CLOSED projectStatus
        spec = spec.and((root, query, criteriaBuilder) -> 
            criteriaBuilder.or(
                criteriaBuilder.notEqual(root.get("projectStatus"), "CLOSE"),
                criteriaBuilder.lessThanOrEqualTo(root.get("closedStatusDateTime"), endOfDay)
            )
        );
    }
}
