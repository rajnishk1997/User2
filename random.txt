import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import org.apache.poi.ss.usermodel.*;
import com.fasterxml.jackson.databind.ObjectMapper;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.net.URL;
import java.util.Map;

public class SwaggerToExcel {
    public static void main(String[] args) throws Exception {
        // Fetch the Swagger JSON from the endpoint
        URL url = new URL("http://localhost:8080/v2/api-docs");
        InputStream inputStream = url.openStream();
        
        // Parse the Swagger JSON
        ObjectMapper objectMapper = new ObjectMapper();
        Map<String, Object> swagger = objectMapper.readValue(inputStream, Map.class);
        
        // Create a new workbook and sheet
        XSSFWorkbook workbook = new XSSFWorkbook();
        Sheet sheet = workbook.createSheet("API Endpoints");
        
        // Create headers for the Excel file
        Row headerRow = sheet.createRow(0);
        headerRow.createCell(0).setCellValue("API Path");
        headerRow.createCell(1).setCellValue("Method");
        headerRow.createCell(2).setCellValue("Description");

        // Extract API details from the Swagger JSON and populate the Excel
        int rowNum = 1;
        Map<String, Map<String, Object>> paths = (Map<String, Map<String, Object>>) swagger.get("paths");
        
        for (String path : paths.keySet()) {
            Map<String, Object> methods = paths.get(path);
            
            for (String method : methods.keySet()) {
                Row row = sheet.createRow(rowNum++);
                row.createCell(0).setCellValue(path);
                row.createCell(1).setCellValue(method.toUpperCase());
                row.createCell(2).setCellValue(methods.get("description") != null ? methods.get("description").toString() : "");
            }
        }

        // Write the Excel file to disk
        try (FileOutputStream fileOut = new FileOutputStream("swagger_api_endpoints.xlsx")) {
            workbook.write(fileOut);
        }

        workbook.close();
    }
}
